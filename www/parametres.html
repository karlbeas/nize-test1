<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>nize</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/fonts/fa-all.css">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body>
    <div class="menu-ferme">
        <div class="tb-m tb-menu-1">
            <i class="fal fa-ellipsis-h"  id="tb-btn-open-menu"></i>
        </div>
        <div class="tb-logo">
            <img src="assets/img/logo-ml-2.png" width="50%" />
        </div>
        <div class="tb-m tb-menu-2">
            <i class="fal fa-search" id="tb-btn-open-recherche"></i>
        </div>
    </div>

    <div class="page-content" id="espace_page_content">
        <div class="bloc_group">
            <div class="titre_bloc">Notifications</div>
            <div class="elt_bloc">
                <div class="inti_bloc">Messages</div>
                <div class="coche_bloc">
                    <label class="switch">
                        <input type="checkbox" class="param_etat" data-param="message" id="param_message">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>
            <div class="elt_bloc">
                <div class="inti_bloc">Nouvel évènement</div>
                <div class="coche_bloc">
                    <label class="switch">
                        <input type="checkbox" class="param_etat" data-param="new_event" id="param_new_event">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>
            <div class="elt_bloc">
                <div class="inti_bloc">Demande de contact</div>
                <div class="coche_bloc">
                    <label class="switch">
                        <input type="checkbox" class="param_etat" data-param="demand_contact" id="demande_contact">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>
            <div class="elt_bloc">
                <div class="inti_bloc">Cloture de participation</div>
                <div class="coche_bloc">
                    <label class="switch">
                        <input type="checkbox"  class="param_etat" data-param="cloture_participation" id="param_cloture_paticipation">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>
        </div>

        <div class="bloc_group">
            <div class="titre_bloc">Sécurité</div>
            <div class="elt_bloc">
                <div class="inti_bloc">Déconnexion automatique</div>
                <div class="coche_bloc">
                    <label class="switch">
                        <input type="checkbox" class="param_etat" data-param="deconnexion_auto" id="param_deconnexion_auto">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>
            <div class="elt_bloc">
                <div class="inti_bloc">invisible à la recherche</div>
                <div class="coche_bloc">
                    <label class="switch">
                        <input type="checkbox" class="param_etat" data-param="visible"  id="param_recherche">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>
            <div class="elt_bloc">
                <div class="inti_bloc">Me localiser</div>
                <div class="coche_bloc">
                    <label class="switch">
                        <input type="checkbox" class="param_etat" data-param="localisation"  id="param_localisation">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>
        </div>

        <div class="bloc_group">
            <div class="titre_bloc">Scan de eTickets</div>
            <div class="elt_bloc">
                <div id="btn_scanneur" class="inti_bloc">Scanner le QRCode (<span id="nb_event_scan" style="font-weight: bold;"></span>)</div>
            </div>
        </div>

        <div class="bloc_group">
            <div class="titre_bloc" id="btn_deconnexion"><i class="far fa-sign-out"></i>  Déconnexion</div>
        </div>
    </div>
    
    <div id="controle_contenu">
        <div class="load_network">
			<img src="assets/img/load_network.gif" />
			<div id="msg-load">Traitement en cours...</div>
		</div>
    </div>

    <div class="menu-ouvert">
        <div class="tb-btn-close">
            <div class="btn-close" id="tb-btn-close-menu"><i class="fal fa-times"></i></div>
        </div>
        <div class="bloc-menu-ouvert">
            <div class="container-fluid">
                <div class="row">
                    <div class="col tb-btn-menu" id="tb-btm-profil">
                        <div class="bulle-menu">
                            <i class="fa fa-user"></i>
                        </div>
                        <div>Profil Utilisateur</div>
                    </div>
                    <div class="col tb-btn-menu" id="tb-btm-messages">
                        <div class="bulle-menu">
                            <i class="fa fa-envelope"></i>
                        </div>
                        <div>Messagerie</div>
                    </div>
                    <div class="col tb-btn-menu" id="tb-btm-my-events">
                        <div class="bulle-menu">
                            <i class="fa fa-star"></i>
                        </div>
                        <div>My Event</div>
                    </div>
                </div> 
                <div class="row" style="margin-top:20px">
                    <div class="col tb-btn-menu"  id="tb-btm-new-event">
                        <div class="bulle-menu">
                            <i class="fal fa-check"></i>
                        </div>
                        <div>Orga-nize It</div>
                    </div>
                    <div class="col tb-btn-menu" id="tb-btm-home">
                        <div class="bulle-menu">
                            <i class="fa fa-home"></i>
                        </div>
                        <div>My E-space</div>
                    </div>
                    <div class="col tb-btn-menu menu-text-active" id="tb-btm-parametres">
                        <div class="bulle-menu menu-active">
                            <i class="fa fa-cog"></i>
                        </div>
                        <div>Paramètre</div>
                    </div>
                </div> 
            </div>
        </div>
    </div>

    <div class="recherche-ouverte">
        <div class="tb-btn-close">
            <div class="btn-close" id="tb-btn-close-menu-2"><i class="fal fa-times"></i></div>
        </div>
        <div class="bloc-recherche-ouvert">
            <input type="text" class="bloc_champ_search" placeholder="Vous recherchez..." id="champ_recherche" />
            <button class="btn_champ_search"><i class="fa fa-search"></i></button>
        </div>
        <iframe src="" class="iframe_search"></iframe>
    </div>

    
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/script.js"></script>
    <script>
        //console.log("demarrage");
        if (typeof localStorage['server'] !== 'undefined') {
            info_server = localStorage['server'];
            //console.log("oui");
        }
        else
        {
            window.location.href = 'index.html';
            //console.log("non");
        }
        

        $("#tb-btn-open-menu").click(function(){
            $(".menu-ouvert").css("height", "100%");
        });
        $("#tb-btn-open-recherche").click(function(){
            $(".recherche-ouverte").css("height", "100%");
        });
        $("#tb-btn-close-menu").click(function(){
            $(".menu-ouvert").css("height", "0%");
        });
        $("#tb-btn-close-menu-2").click(function(){
            $(".recherche-ouverte").css("height", "0%");
        });


        $("#tb-btm-home").click(function(){
            window.location.href = 'tableau-de-bord.html';
        });
        $("#tb-btm-new-event").click(function(){
            window.location.href = 'new-event.html';
        });
        $("#tb-btm-my-events").click(function(){
            window.location.href = 'my-events.html';
        });
        $("#tb-btm-parametres").click(function(){
            window.location.href = 'parametres.html';
        });
        $("#tb-btm-profil").click(function(){
            window.location.href = 'profil.html';
        });
        $("#tb-btm-messages").click(function(){
            window.location.href = 'messages.html';
        });

        $(".bulle_bas").click(function(){
            window.location.href = 'new-event.html';
        });

        /* Controle de la connexion au serveur */

        setInterval(test_internet, 1000);

        function test_localInternet()
        {
            
            if(localStorage['internet'] == '0')
            {
				$("#msg-load").html("Problème de connexion...");
                $("#controle_contenu").css("height","90%");
            }
            else
            {
				$("#msg-load").html("Traitement en cours...");
                $("#controle_contenu").css("height","0px");
            }
        }

        function test_internet()
        {
            $.ajax({
                method: "POST",
                url: SERVER_API + "_00_internet.php",
                data: { id: 'nize' }
            })
            .done(function( msg ) 
            {
                if(msg == "OK")
                {
                    localStorage['internet'] = '1';
                }
                else
                {
                    localStorage['internet'] = '0';
                }
            })
            .fail(function (jqXHR, textStatus, errorThrown) 
            { 
                localStorage['internet'] = '0';
            });

            test_localInternet();
        }

        $("#btn_deconnexion").click(function(){
            window.location.href = 'deconnexion.html';
        });

        // Get nombre de d'évènement scannable
        info_server = JSON.parse(localStorage['server']);
        var user = info_server.user;
        var ui = user.infos;

        $.ajax({
            method: "POST",
            url: SERVER_API + "iframes/preferences/get_nb_escan.php",
            data: { id: 'nize', uid: ui.id }
        })
        .done(function( msg ) 
        {
            $("#nb_event_scan").html(msg);
        })
        .fail(function (jqXHR, textStatus, errorThrown) 
        { 
            //localStorage['internet'] = '0';
        });

        $("#btn_scanneur").click(function(){
            window.location.href = 'les_events_scan.html';
        });

        //Gestion des paramètres
        var parametres = '{"message":"0","new_event":"0","demand_contact":"0","cloture_participation":"0","deconnexion_auto":"0","visible":"0","localisation":"0"}';

        load_parametre();

        $(".param_etat").click(function(){
            param = JSON.parse(parametres);
            if(($(this).is(':checked')))
            {
                param[$(this).attr("data-param")] = "1";
                parametres = JSON.stringify(param);
            }
            else
            {
                param[$(this).attr("data-param")] = "0";
                parametres = JSON.stringify(param);
            }
            set_parametre(parametres)
        });


        function load_parametre()
        {
            $.ajax({
                method: "POST",
                url: SERVER_API + "_9_get_parametres.php",
                data: { id: 'nize', uid: ui.id_app }
            })
            .done(function( msg ) 
            {
                if(msg != "")
                {
                    parametres = msg;
                }

                param = JSON.parse(parametres);

                // message
                if(param.message == "1")
                {
                    $("#param_message").attr("checked","checked");
                }
                else
                {
                    $("#param_message").removeAttr("checked");
                }
                // new_event
                if(param.new_event == "1")
                {
                    $("#param_new_event").attr("checked","checked");
                }
                else
                {
                    $("#param_new_event").removeAttr("checked");
                }
                // demand_contact
                if(param.demand_contact == "1")
                {
                    $("#demande_contact").attr("checked","checked");
                }
                else
                {
                    $("#demande_contact").removeAttr("checked");
                }
                // cloture_participation
                if(param.cloture_participation == "1")
                {
                    $("#param_cloture_paticipation").attr("checked","checked");
                }
                else
                {
                    $("#param_cloture_paticipation").removeAttr("checked");
                }
                // deconnexion_auto
                if(param.deconnexion_auto == "1")
                {
                    $("#param_deconnexion_auto").attr("checked","checked");
                }
                else
                {
                    $("#param_deconnexion_auto").removeAttr("checked");
                }
                // visible
                if(param.visible == "1")
                {
                    $("#param_recherche").attr("checked","checked");
                }
                else
                {
                    $("#param_recherche").removeAttr("checked");
                }
                // localisation
                if(param.localisation == "1")
                {
                    $("#param_localisation").attr("checked","checked");
                }
                else
                {
                    $("#param_localisation").removeAttr("checked");
                }
            })
            .fail(function (jqXHR, textStatus, errorThrown) 
            { 
                localStorage['internet'] = '0';
            });
        }

        function set_parametre(p)
        {
            $.ajax({
                method: "POST",
                url: SERVER_API + "_9_set_parametres.php",
                data: { id: 'nize', uid: ui.id_app, param: p }
            })
            .done(function( msg ) 
            {
                if(msg == "")
                {
                    load_parametre();
                }
            })
            .fail(function (jqXHR, textStatus, errorThrown) 
            { 
                localStorage['internet'] = '0';
            });
        }
        
    </script>
</body>

</html>